CREATE MATERIALIZED VIEW "public"."budget_spend" AS (select "budget"."id", "budget"."createdAt", "budget"."updatedAt", "budget"."amount", "budget"."name", "budget"."teamId", "budget"."validFrom", "budget"."validUntil", sum("purchase"."amount")::int as "spent", ("budget"."amount" - sum("purchase"."amount"))::int as "remaining" from "budget" left join "purchase" on "budget"."id" = "purchase"."budgetId" group by "budget"."id");